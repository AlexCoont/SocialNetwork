webpackJsonp([4],{"QJN+":function(e,s){},TxAb:function(e,s){},uA75:function(e,s){},zfg2:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=t("Xxa5"),a=t.n(i),n=t("exGp"),o=t.n(n),l=t("Dd8w"),c=t.n(l),r=t("PJh5"),m=t.n(r),u=t("NYxO"),_={name:"ImDialog",props:{active:Boolean,push:Number,online:Boolean,me:Boolean,info:Object},computed:{statusText:function(){return this.online?"Онлайн":"был в сети "+m()(this.info.last_message.recipient.last_online_time).fromNow()}}},g={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"im-dialog",class:{active:e.active,push:e.push}},[t("router-link",{staticClass:"im-dailog__pic",attrs:{to:{name:"ProfileId",params:{id:e.info.last_message.recipient.id}}}},[t("img",{attrs:{src:e.info.last_message.recipient.photo,alt:e.info.last_message.recipient.first_name}})]),t("div",{staticClass:"im-dialog__info"},[t("router-link",{staticClass:"im-dialog__name",attrs:{to:{name:"ProfileId",params:{id:e.info.last_message.recipient.id}}}},[e._v(e._s(e.info.last_message.recipient.first_name+" "+e.info.last_message.recipient.last_name))]),t("span",{staticClass:"user-status",class:{online:e.online}},[e._v(e._s(e.statusText))])],1),t("div",{staticClass:"im-dialog__content"},[t("p",{staticClass:"im-dialog__last"},[e.me?t("span",{staticClass:"im-dialog__last-me"},[e._v("Вы: ")]):e._e(),e._v(e._s(e.info.last_message.message_text))]),t("span",{staticClass:"im-dialog__time"},[e._v(e._s(e._f("moment")(e.info.last_message.time,"from")))])]),e.push>0?t("span",{staticClass:"im-dialog__push"},[e._v(e._s(e.push))]):e._e()],1)},staticRenderFns:[]};var f=t("VU/8")(_,g,!1,function(e){t("uA75")},null,null).exports,d={name:"ImChat",props:{info:Object,messages:Array,online:Boolean},data:function(){return{mes:""}},computed:{statusText:function(){return this.online?"Онлайн":"был в сети "+m()(this.info.last_message.recipient.last_online_time).fromNow()}},methods:c()({},Object(u.b)("profile/dialogs",["postMessage"]),{onSubmitMessage:function(){this.postMessage({id:this.info.id,message_text:this.mes}),this.mes=""}}),mounted:function(){this.$refs.messageBlock.scrollTop=this.$refs.messageBlock.scrollHeight}},p={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"im-chat"},[t("div",{staticClass:"im-chat__user"},[t("router-link",{staticClass:"im-chat__user-pic",attrs:{to:{name:"ProfileId",params:{id:e.info.last_message.recipient.id}}}},[t("img",{attrs:{src:e.info.last_message.recipient.photo,alt:e.info.last_message.recipient.first_name}})]),t("router-link",{staticClass:"im-chat__user-name",attrs:{to:{name:"ProfileId",params:{id:e.info.last_message.recipient.id}}}},[e._v(e._s(e.info.last_message.recipient.first_name+" "+e.info.last_message.recipient.last_name))]),t("span",{staticClass:"user-status",class:{online:e.online}},[e._v(e._s(e.statusText))])],1),t("div",{ref:"messageBlock",staticClass:"im-chat__message"},e._l(e.messages,function(s){return t("div",{key:s.date,staticClass:"im-chat__message-day"},[t("h5",{staticClass:"im-chat__message-title"},[e._v(e._s(e._f("moment")(s.date,"DD MMMM YYYY")))]),e._l(s.messages,function(s){return t("div",{key:s.id,staticClass:"im-chat__message-block",class:{me:s.isSentByMe}},[t("p",{staticClass:"im-chat__message-text"},[e._v(e._s(s.message_text))]),t("span",{staticClass:"im-chat__message-time"},[e._v(e._s(e._f("moment")(s.time,"hh:mm")))])])})],2)}),0),t("form",{staticClass:"im-chat__enter",attrs:{action:"#"},on:{submit:function(s){return s.preventDefault(),e.onSubmitMessage(s)}}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.mes,expression:"mes"}],staticClass:"im-chat__enter-input",attrs:{type:"text",placeholder:"Ваше сообщение..."},domProps:{value:e.mes},on:{input:function(s){s.target.composing||(e.mes=s.target.value)}}})])])},staticRenderFns:[]};var h={name:"Im",components:{ImDialog:f,ImChat:t("VU/8")(d,p,!1,function(e){t("QJN+")},null,null).exports},computed:c()({},Object(u.c)("profile/dialogs",["getMessages","activeDialog","dialogs","dialogsLoaded"])),methods:c()({},Object(u.b)("profile/dialogs",["apiDialogs","dialogsMessages","switchDialog","closeDialog"]),{countPush:function(e){return e>0?e:null},checkOnlineUser:function(e){return m()().diff(m()(e),"seconds")<=60},clickOnDialog:function(e){this.$router.push({name:"Im",query:{activeDialog:e}})},selectDialogByRoute:function(e,s){e.query.activeDialog?s.switchDialog(e.query.activeDialog):s.dialogs.length>0?s.$router.push({name:"Im",query:{activeDialog:s.dialogs[0].id}}):console.log("No dialogs at all")}}),beforeRouteEnter:function(e,s,t){var i,n=this;t((i=o()(a.a.mark(function s(t){return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(t.dialogsLoaded){s.next=3;break}return s.next=3,t.apiDialogs(t.to);case 3:t.selectDialogByRoute(e,t);case 4:case"end":return s.stop()}},s,n)})),function(e){return i.apply(this,arguments)}))},beforeRouteUpdate:function(e,s,t){this.selectDialogByRoute(e,this),t()},beforeDestroy:function(){this.closeDialog()}},v={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"im"},[t("div",{staticClass:"im__dialogs"},e._l(e.dialogs,function(s){return t("im-dialog",{key:s.id,attrs:{info:s,push:e.countPush(s.unread_count),me:s.last_message.isSentByMe,active:e.activeDialog&&s.id===e.activeDialog.id,online:e.checkOnlineUser(s.last_message.recipient.last_online_time)},nativeOn:{click:function(t){return e.clickOnDialog(s.id)}}})}),1),e.activeDialog?t("div",{staticClass:"im__chat"},[t("im-chat",{attrs:{info:e.activeDialog,messages:e.getMessages,online:e.checkOnlineUser(e.activeDialog.last_message.recipient.last_online_time)}})],1):e._e()])},staticRenderFns:[]};var C=t("VU/8")(h,v,!1,function(e){t("TxAb")},null,null);s.default=C.exports}});
//# sourceMappingURL=4.07aa2e5ffa8724a3c0ad.js.map